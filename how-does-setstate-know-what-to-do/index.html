<!DOCTYPE html><html lang="en" class="__className_e34cb4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://github.com/gaearon.png"/><link rel="stylesheet" href="/_next/static/css/0f6647b39fdbcb3d.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3c6c21fa7f32edf2.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f9d4d708579596e8.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-da4818c833129d2a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-44c3d350117a997d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-74b5bca37634105e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/569-52e5d813bbfa85ea.js" async=""></script><script src="/_next/static/chunks/app/layout-cfb37acb14684668.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js" async=""></script><title>How Does setState Know What to Do? — overreacted</title><meta name="description" content="Dependency injection is nice if you don’t have to think about it."/><link rel="icon" href="/icon.png?e0852c1e2c7f0e65" type="image/png" sizes="329x329"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]"><header class="mb-14 flex flex-row place-content-between"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a><span class="relative top-[4px] italic">by<!-- --> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://danabra.mov"><img alt="Dan Abramov" src="https://github.com/gaearon.png" class="relative -top-1 mx-1 inline h-8 w-8 rounded-full"/></a></span></header><main><article><h1 class="__className_b47211 text-[40px] font-black leading-[44px] text-[--title]">How Does setState Know What to Do?</h1><p class="mt-2 text-[13px] text-gray-700 dark:text-gray-300">December 9, 2018</p><div class="markdown mt-10"><p>When you call <code>setState</code> in a component, what do you think happens?</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">import</span><span style="color:#CED2D6"> React </span><span style="color:#FFA7C4">from</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#FFA7C4">import</span><span style="color:#CED2D6"> ReactDOM </span><span style="color:#FFA7C4">from</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react-dom</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Button</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">extends</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">Component </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">constructor</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">props</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">super</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">props</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">state </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> clicked</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">false</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">handleClick </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">handleClick</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">bind</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">handleClick</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">setState</span><span style="color:#C792EA">({</span><span style="color:#CED2D6"> clicked</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">true</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">});</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">render</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">if</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">state</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">clicked</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">h1</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">Thanks</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">h1</span><span style="color:#C792EA">&gt;;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">button</span><span style="color:#C792EA"> onClick={</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">handleClick</span><span style="color:#C792EA">}&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">        Click me!</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">button</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">ReactDOM</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">render</span><span style="color:#C792EA">(&lt;</span><span style="color:#FFA7C4">Button</span><span style="color:#C792EA"> /&gt;,</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">document</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">getElementById</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">container</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">));</span></span></code></pre></div>
<p>Sure, React re-renders the component with the next <code>{ clicked: true }</code> state and updates the DOM to match the returned <code>&lt;h1&gt;Thanks&lt;/h1&gt;</code> element.</p>
<p>Seems straightforward. But wait, does <em>React</em> do it? Or <em>React DOM</em>?</p>
<p>Updating the DOM sounds like something React DOM would be responsible for. But we’re calling <code>this.setState()</code>, not something from React DOM. And our <code>React.Component</code> base class is defined inside React itself.</p>
<p>So how can <code>setState()</code> inside <code>React.Component</code> update the DOM?</p>
<p><strong>Disclaimer: Just like <a class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/why-do-react-elements-have-typeof-property/">most</a> <a class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/how-does-react-tell-a-class-from-a-function/">other</a> <a class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/why-do-we-write-super-props/">posts</a> on this blog, you don’t actually <em>need</em> to know any of that to be productive with React. This post is for those who like to see what’s behind the curtain. Completely optional!</strong></p>
<hr/>
<p>We might think that the <code>React.Component</code> class contains DOM update logic.</p>
<p>But if that were the case, how can <code>this.setState()</code> work in other environments? For example, components in React Native apps also extend <code>React.Component</code>. They call <code>this.setState()</code> just like we did above, and yet React Native works with Android and iOS native views instead of the DOM.</p>
<p>You might also be familiar with React Test Renderer or Shallow Renderer. Both of these testing strategies let you render normal components and call <code>this.setState()</code> inside them. But neither of them works with the DOM.</p>
<p>If you used renderers like <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/tree/master/packages/react-art">React ART</a>, you might also know that it’s possible to use more than one renderer on the page. (For example, ART components work inside a React DOM tree.) This makes a global flag or variable untenable.</p>
<p>So somehow <strong><code>React.Component</code> delegates handling state updates to the platform-specific code.</strong> Before we can understand how this happens, let’s dig deeper into how packages are separated and why.</p>
<hr/>
<p>There is a common misconception that the React “engine” lives inside the <code>react</code> package. This is not true.</p>
<p>In fact, ever since the <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://reactjs.org/blog/2015/07/03/react-v0.14-beta-1.html#two-packages">package split in React 0.14</a>, the <code>react</code> package intentionally only exposes APIs for <em>defining</em> components. Most of the <em>implementation</em> of React lives in the “renderers”.</p>
<p><code>react-dom</code>, <code>react-dom/server</code>, <code>react-native</code>, <code>react-test-renderer</code>, <code>react-art</code> are some examples of renderers (and you can <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/master/packages/react-reconciler/README.md#practical-examples">build your own</a>).</p>
<p>This is why the <code>react</code> package is useful regardless of which platform you target. All its exports, such as <code>React.Component</code>, <code>React.createElement</code>, <code>React.Children</code> utilities and (eventually) <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://reactjs.org/docs/hooks-intro.html">Hooks</a>, are independent of the target platform. Whether you run React DOM, React DOM Server, or React Native, your components would import and use them in the same way.</p>
<p>In contrast, the renderer packages expose platform-specific APIs like <code>ReactDOM.render()</code> that let you mount a React hierarchy into a DOM node. Each renderer provides an API like this. Ideally, most <em>components</em> shouldn’t need to import anything from a renderer. This keeps them more portable.</p>
<p><strong>What most people imagine as the React “engine” is inside each individual renderer.</strong> Many renderers include a copy of the same code — we call it the <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/tree/master/packages/react-reconciler">“reconciler”</a>. A <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html#migrating-to-google-closure-compiler">build step</a> smooshes the reconciler code together with the renderer code into a single highly optimized bundle for better performance. (Copying code is usually not great for bundle size but the vast majority of React users only needs one renderer at a time, such as <code>react-dom</code>.)</p>
<p>The takeaway here is that the <code>react</code> package only lets you <em>use</em> React features but doesn’t know anything about <em>how</em> they’re implemented. The renderer packages (<code>react-dom</code>, <code>react-native</code>, etc) provide the implementation of React features and platform-specific logic. Some of that code is shared (“reconciler”) but that’s an implementation detail of individual renderers.</p>
<hr/>
<p>Now we know why <em>both</em> <code>react</code> and <code>react-dom</code> packages need to be updated for new features. For example, when React 16.3 added the Context API, <code>React.createContext()</code> was exposed on the React package.</p>
<p>But <code>React.createContext()</code> doesn’t actually <em>implement</em> the context feature. The implementation would need to be different between React DOM and React DOM Server, for example. So <code>createContext()</code> returns a few plain objects:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// A bit simplified</span></span>
<span data-line=""><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">createContext</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">defaultValue</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let </span><span style="color:#CED2D6">context</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#FFA7C4">    </span><span style="color:#CED2D6">_currentValue</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> defaultValue</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#FFA7C4">    </span><span style="color:#CED2D6">Provider</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#FFA7C4">    </span><span style="color:#CED2D6">Consumer</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">null</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">context</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">Provider </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    $$typeof</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">Symbol</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">for</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react.provider</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">),</span></span>
<span data-line=""><span style="color:#CED2D6">    _context</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> context</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">context</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">Consumer </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    $$typeof</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">Symbol</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">for</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react.context</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">),</span></span>
<span data-line=""><span style="color:#CED2D6">    _context</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> context</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> context</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>When you use <code>&lt;MyContext.Provider&gt;</code> or <code>&lt;MyContext.Consumer&gt;</code> in the code, it’s the <em>renderer</em> that decides how to handle them. React DOM might track context values in one way, but React DOM Server might do it differently.</p>
<p><strong>So if you update <code>react</code> to 16.3+ but don’t update <code>react-dom</code>, you’d be using a renderer that isn’t yet aware of the special <code>Provider</code> and <code>Consumer</code> types.</strong> This is why an older <code>react-dom</code> would <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://stackoverflow.com/a/49677020/458193">fail saying these types are invalid</a>.</p>
<p>The same caveat applies to React Native. However, unlike React DOM, a React release doesn’t immediately “force” a React Native release. They have an independent release schedule. The updated renderer code is <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react-native/commits/master/Libraries/Renderer/oss">separately synced</a> into the React Native repository once in a few weeks. This is why features become available in React Native on a different schedule than in React DOM.</p>
<hr/>
<p>Okay, so now we know that the <code>react</code> package doesn’t contain anything interesting, and the implementation lives in renderers like <code>react-dom</code>, <code>react-native</code>, and so on. But that doesn’t answer our question. How does <code>setState()</code> inside <code>React.Component</code> “talk” to the right renderer?</p>
<p><strong>The answer is that every renderer sets a special field on the created class.</strong> This field is called <code>updater</code>. It’s not something <em>you</em> would set — rather, it’s something React DOM, React DOM Server or React Native set right after creating an instance of your class:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// Inside React DOM</span></span>
<span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">inst</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">new</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">YourComponent</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">props </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> props</span><span style="color:#C792EA">;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">updater </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> ReactDOMUpdater</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#637777">// Inside React DOM Server</span></span>
<span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">inst</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">new</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">YourComponent</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">props </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> props</span><span style="color:#C792EA">;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">updater </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> ReactDOMServerUpdater</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#637777">// Inside React Native</span></span>
<span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">inst</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">new</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">YourComponent</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">props </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> props</span><span style="color:#C792EA">;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">inst</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">updater </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> ReactNativeUpdater</span><span style="color:#C792EA">;</span></span></code></pre></div>
<p>Looking at the <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactBaseClasses.js#L58-L67"><code>setState</code> implementation in <code>React.Component</code></a>, all it does is delegate work to the renderer that created this component instance:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// A bit simplified</span></span>
<span data-line=""><span style="color:#8EACE3">setState</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">partialState</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> callback</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">// Use the `updater` field to talk back to the renderer!</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">updater</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">enqueueSetState</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> partialState</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> callback</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>React DOM Server <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRenderer.js#L442-L448">might want to</a> ignore a state update and warn you, whereas React DOM and React Native would let their copies of the reconciler <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberClassComponent.js#L190-L207">handle it</a>.</p>
<p>And this is how <code>this.setState()</code> can update the DOM even though it’s defined in the React package. It reads <code>this.updater</code> which was set by React DOM, and lets React DOM schedule and handle the update.</p>
<hr/>
<p>We know about classes now, but what about Hooks?</p>
<p>When people first look at the <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://reactjs.org/docs/hooks-intro.html">Hooks proposal API</a>, they often wonder: how does <code>useState</code> “know what to do”? The assumption is that it’s more “magical” than a base <code>React.Component</code> class with <code>this.setState()</code>.</p>
<p>But as we have seen today, the base class <code>setState()</code> implementation has been an illusion all along. It doesn’t do anything except forwarding the call to the current renderer. And <code>useState</code> Hook <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactHooks.js#L55-L56">does exactly the same thing</a>.</p>
<p><strong>Instead of an <code>updater</code> field, Hooks use a “dispatcher” object.</strong> When you call <code>React.useState()</code>, <code>React.useEffect()</code>, or another built-in Hook, these calls are forwarded to the current dispatcher.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// In React (simplified a bit)</span></span>
<span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">React</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#637777">// Real property is hidden a bit deeper, see if you can find it!</span></span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#CED2D6">__currentDispatcher</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">initialState</span><span style="color:#C792EA">)</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#FFA7C4">    return React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">__currentDispatcher</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">initialState</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#C792EA">},</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#8EACE3">useEffect</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">initialState</span><span style="color:#C792EA">)</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#FFA7C4">    return React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">__currentDispatcher</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">useEffect</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">initialState</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#FFA7C4">  </span><span style="color:#637777">// ...</span></span>
<span data-line=""><span style="color:#C792EA">};</span></span></code></pre></div>
<p>And individual renderers set the dispatcher before rendering your component:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// In React DOM</span></span>
<span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">prevDispatcher</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">__currentDispatcher</span><span style="color:#C792EA">;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">__currentDispatcher </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> ReactDOMDispatcher</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#FFA7C4">let </span><span style="color:#CED2D6">result</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#FFA7C4">try</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  result </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">YourComponent</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">props</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">finally</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">// Restore it back</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">React</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">__currentDispatcher </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> prevDispatcher</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>For example, the React DOM Server implementation is <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRendererHooks.js#L340-L354">here</a>, and the reconciler implementation shared by React DOM and React Native is <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberHooks.js">here</a>.</p>
<p>This is why a renderer such as <code>react-dom</code> needs to access the same <code>react</code> package that you call Hooks from. Otherwise, your component won’t “see” the dispatcher! This may not work when you have <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/issues/13991">multiple copies of React</a> in the same component tree. However, this has always led to obscure bugs so Hooks force you to solve the package duplication before it costs you.</p>
<p>While we don’t encourage this, you can technically override the dispatcher yourself for advanced tooling use cases. (I lied about  <code>__currentDispatcher</code> name but you can find the real one in the React repo.) For example, React DevTools will use <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-debug-tools/src/ReactDebugHooks.js#L203-L214">a special purpose-built dispatcher</a> to introspect the Hooks tree by capturing JavaScript stack traces. <em>Don’t repeat this at home.</em></p>
<p>This also means Hooks aren’t inherently tied to React. If in the future more libraries want to reuse the same primitive Hooks, in theory the dispatcher could move to a separate package and be exposed as a first-class API with a less “scary” name. In practice, we’d prefer to avoid premature abstraction until there is a need for it.</p>
<p>Both the <code>updater</code> field and the <code>__currentDispatcher</code> object are forms of a generic programming principle called <em>dependency injection</em>. In both cases, the renderers “inject” implementations of features like <code>setState</code> into the generic React package to keep your components more declarative.</p>
<p>You don’t need to think about how this works when you use React. We’d like React users to spend more time thinking about their application code than abstract concepts like dependency injection. But if you’ve ever wondered how <code>this.setState()</code> or <code>useState()</code> know what to do, I hope this helps.</p><hr/><p><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fhow-does-setstate-know-what-to-do%2F">Discuss on 𝕏</a>  ·  <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/gaearon/overreacted.io/edit/main/public/how-does-setstate-know-what-to-do/index.md">Edit on GitHub</a></p></div></article><footer class="mt-12"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a></footer></main><script src="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/0f6647b39fdbcb3d.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/3c6c21fa7f32edf2.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/f9d4d708579596e8.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[3728,[],\"\"]\n7:I[9928,[],\"\"]\n8:I[4982,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"185\",\"static/chunks/app/layout-cfb37acb14684668.js\"],\"\"]\n9:I[8256,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"64\",\"static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js\"],\"\"]\na:I[2008,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js\"],\"\"]\nb:I[6954,[],\"\"]\nc:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f6647b39fdbcb3d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"iWWiOWlg3tDiHen4DuUO-\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/how-does-setstate-know-what-to-do/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"how-does-setstate-know-what-to-do\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"how-does-setstate-know-what-to-do\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"$L8\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__className_e34cb4\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-14 flex flex-row place-content-between\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"span\",null,{\"className\":\"relative top-[4px] italic\",\"children\":[\"by\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://danabra.mov\",\"target\":\"_blank\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Dan Abramov\",\"src\":\"https://github.com/gaearon.png\",\"className\":\"relative -top-1 mx-1 inline h-8 w-8 rounded-full\"}]}]]}]]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"article\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Not found\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[[\"$\",\"p\",null,{\"children\":\"This page doesn't exist (yet?)\"}],[\"$\",\"p\",null,{\"children\":[\"I recently rewrote the site so maybe something broke. Please\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/issues/796\",\"children\":\"complain here.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If you're looking for translated posts, they're not on the site anymore but you can find\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/tree/archive/src/pages\",\"children\":\"an archive of them here.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Hope you'll find what you're looking for.\"}]]}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"childProp\":{\"current\":[null,[[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",[\"slug\",\"how-does-setstate-know-what-to-do\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",\"$Le\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"how-does-setstate-know-what-to-do\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-12\",\"children\":[\"$\",\"$L9\",null,{}]}]],null],\"segment\":[\"slug\",\"how-does-setstate-know-what-to-do\",\"d\"]},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3c6c21fa7f32edf2.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"article\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"How Does setState Know What to Do?\"}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-[13px] text-gray-700 dark:text-gray-300\",\"children\":\"December 9, 2018\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[\"$Lf\",[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"$La\",null,{\"href\":\"https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fhow-does-setstate-know-what-to-do%2F\",\"children\":\"Discuss on 𝕏\"}],\"  ·  \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/edit/main/public/how-does-setstate-know-what-to-do/index.md\",\"children\":\"Edit on GitHub\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"How Does setState Know What to Do? — overreacted\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Dependency injection is nice if you don’t have to think about it.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/icon.png?e0852c1e2c7f0e65\",\"type\":\"image/png\",\"sizes\":\"329x329\"}]]\nd:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"p\",null,{\"children\":[\"When you call \",[\"$\",\"code\",null,{\"children\":\"setState\"}],\" in a component, what do you think happens?\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" React \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" ReactDOM \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react-dom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Button\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"extends\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Component \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"super\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"state \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" clicked\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"false\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"handleClick \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"handleClick\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"bind\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"handleClick\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"({\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" clicked\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"render\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"state\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"clicked\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Thanks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"button\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" onClick={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"handleClick\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        Click me!\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"button\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ReactDOM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"render\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Button\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e,\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"document\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"getElementById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"container\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"));\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Sure, React re-renders the component with the next \",[\"$\",\"code\",null,{\"children\":\"{ clicked: true }\"}],\" state and updates the DOM to match the returned \",[\"$\",\"code\",null,{\"children\":\"\u003ch1\u003eThanks\u003c/h1\u003e\"}],\" element.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Seems straightforward. But wait, does \",[\"$\",\"em\",null,{\"children\":\"React\"}],\" do it? Or \",[\"$\",\"em\",null,{\"children\":\"React DOM\"}],\"?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Updating the DOM sounds like something React DOM would be responsible for. But we’re calling \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\", not something from React DOM. And our \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" base class is defined inside React itself.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"So how can \",[\"$\",\"code\",null,{\"children\":\"setState()\"}],\" inside \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" update the DOM?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"Disclaimer: Just like \",[\"$\",\"$La\",null,{\"href\":\"/why-do-react-elements-have-typeof-property/\",\"children\":\"most\"}],\" \",[\"$\",\"$La\",null,{\"href\":\"/how-does-react-tell-a-class-from-a-function/\",\"children\":\"other\"}],\" \",[\"$\",\"$La\",null,{\"href\":\"/why-do-we-write-super-props/\",\"children\":\"posts\"}],\" on this blog, you don’t actually \",[\"$\",\"em\",null,{\"children\":\"need\"}],\" to know any of that to be productive with React. This post is for those who like to see what’s behind the curtain. Completely optional!\"]}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We might think that the \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" class contains DOM update logic.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"But if that were the case, how can \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\" work in other environments? For example, components in React Native apps also extend \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\". They call \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\" just like we did above, and yet React Native works with Android and iOS native views instead of the DOM.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You might also be familiar with React Test Renderer or Shallow Renderer. Both of these testing strategies let you render normal components and call \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\" inside them. But neither of them works with the DOM.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you used renderers like \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/tree/master/packages/react-art\",\"children\":\"React ART\"}],\", you might also know that it’s possible to use more than one renderer on the page. (For example, ART components work inside a React DOM tree.) This makes a global flag or variable untenable.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"So somehow \",[\"$\",\"strong\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" delegates handling state updates to the platform-specific code.\"]}],\" Before we can understand how this happens, let’s dig deeper into how packages are separated and why.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"There is a common misconception that the React “engine” lives inside the \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package. This is not true.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In fact, ever since the \",[\"$\",\"$La\",null,{\"href\":\"https://reactjs.org/blog/2015/07/03/react-v0.14-beta-1.html#two-packages\",\"children\":\"package split in React 0.14\"}],\", the \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package intentionally only exposes APIs for \",[\"$\",\"em\",null,{\"children\":\"defining\"}],\" components. Most of the \",[\"$\",\"em\",null,{\"children\":\"implementation\"}],\" of React lives in the “renderers”.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-dom/server\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-native\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-test-renderer\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-art\"}],\" are some examples of renderers (and you can \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/master/packages/react-reconciler/README.md#practical-examples\",\"children\":\"build your own\"}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This is why the \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package is useful regardless of which platform you target. All its exports, such as \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\", \",[\"$\",\"code\",null,{\"children\":\"React.createElement\"}],\", \",[\"$\",\"code\",null,{\"children\":\"React.Children\"}],\" utilities and (eventually) \",[\"$\",\"$La\",null,{\"href\":\"https://reactjs.org/docs/hooks-intro.html\",\"children\":\"Hooks\"}],\", are independent of the target platform. Whether you run React DOM, React DOM Server, or React Native, your components would import and use them in the same way.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In contrast, the renderer packages expose platform-specific APIs like \",[\"$\",\"code\",null,{\"children\":\"ReactDOM.render()\"}],\" that let you mount a React hierarchy into a DOM node. Each renderer provides an API like this. Ideally, most \",[\"$\",\"em\",null,{\"children\":\"components\"}],\" shouldn’t need to import anything from a renderer. This keeps them more portable.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What most people imagine as the React “engine” is inside each individual renderer.\"}],\" Many renderers include a copy of the same code — we call it the \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/tree/master/packages/react-reconciler\",\"children\":\"“reconciler”\"}],\". A \",[\"$\",\"$La\",null,{\"href\":\"https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html#migrating-to-google-closure-compiler\",\"children\":\"build step\"}],\" smooshes the reconciler code together with the renderer code into a single highly optimized bundle for better performance. (Copying code is usually not great for bundle size but the vast majority of React users only needs one renderer at a time, such as \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\".)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The takeaway here is that the \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package only lets you \",[\"$\",\"em\",null,{\"children\":\"use\"}],\" React features but doesn’t know anything about \",[\"$\",\"em\",null,{\"children\":\"how\"}],\" they’re implemented. The renderer packages (\",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-native\"}],\", etc) provide the implementation of React features and platform-specific logic. Some of that code is shared (“reconciler”) but that’s an implementation detail of individual renderers.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now we know why \",[\"$\",\"em\",null,{\"children\":\"both\"}],\" \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\" packages need to be updated for new features. For example, when React 16.3 added the Context API, \",[\"$\",\"code\",null,{\"children\":\"React.createContext()\"}],\" was exposed on the React package.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"But \",[\"$\",\"code\",null,{\"children\":\"React.createContext()\"}],\" doesn’t actually \",[\"$\",\"em\",null,{\"children\":\"implement\"}],\" the context feature. The implementation would need to be different between React DOM and React DOM Server, for example. So \",[\"$\",\"code\",null,{\"children\":\"createContext()\"}],\" returns a few plain objects:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// A bit simplified\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"createContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"defaultValue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"_currentValue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" defaultValue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Provider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Consumer\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Provider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    $$typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Symbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react.provider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    _context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" context\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Consumer \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    $$typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Symbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react.context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    _context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When you use \",[\"$\",\"code\",null,{\"children\":\"\u003cMyContext.Provider\u003e\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"\u003cMyContext.Consumer\u003e\"}],\" in the code, it’s the \",[\"$\",\"em\",null,{\"children\":\"renderer\"}],\" that decides how to handle them. React DOM might track context values in one way, but React DOM Server might do it differently.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"So if you update \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" to 16.3+ but don’t update \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\", you’d be using a renderer that isn’t yet aware of the special \",[\"$\",\"code\",null,{\"children\":\"Provider\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"Consumer\"}],\" types.\"]}],\" This is why an older \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\" would \",[\"$\",\"$La\",null,{\"href\":\"https://stackoverflow.com/a/49677020/458193\",\"children\":\"fail saying these types are invalid\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The same caveat applies to React Native. However, unlike React DOM, a React release doesn’t immediately “force” a React Native release. They have an independent release schedule. The updated renderer code is \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react-native/commits/master/Libraries/Renderer/oss\",\"children\":\"separately synced\"}],\" into the React Native repository once in a few weeks. This is why features become available in React Native on a different schedule than in React DOM.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Okay, so now we know that the \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package doesn’t contain anything interesting, and the implementation lives in renderers like \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\", \",[\"$\",\"code\",null,{\"children\":\"react-native\"}],\", and so on. But that doesn’t answer our question. How does \",[\"$\",\"code\",null,{\"children\":\"setState()\"}],\" inside \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" “talk” to the right renderer?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"The answer is that every renderer sets a special field on the created class.\"}],\" This field is called \",[\"$\",\"code\",null,{\"children\":\"updater\"}],\". It’s not something \",[\"$\",\"em\",null,{\"children\":\"you\"}],\" would set — rather, it’s something React DOM, React DOM Server or React Native set right after creating an instance of your class:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Inside React DOM\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"YourComponent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"updater \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" ReactDOMUpdater\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Inside React DOM Server\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"YourComponent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"updater \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" ReactDOMServerUpdater\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Inside React Native\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"YourComponent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"inst\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"updater \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" ReactNativeUpdater\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Looking at the \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactBaseClasses.js#L58-L67\",\"children\":[[\"$\",\"code\",null,{\"children\":\"setState\"}],\" implementation in \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}]]}],\", all it does is delegate work to the renderer that created this component instance:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// A bit simplified\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"partialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" callback\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Use the `updater` field to talk back to the renderer!\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"updater\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"enqueueSetState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" partialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" callback\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"React DOM Server \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRenderer.js#L442-L448\",\"children\":\"might want to\"}],\" ignore a state update and warn you, whereas React DOM and React Native would let their copies of the reconciler \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberClassComponent.js#L190-L207\",\"children\":\"handle it\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"And this is how \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\" can update the DOM even though it’s defined in the React package. It reads \",[\"$\",\"code\",null,{\"children\":\"this.updater\"}],\" which was set by React DOM, and lets React DOM schedule and handle the update.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We know about classes now, but what about Hooks?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When people first look at the \",[\"$\",\"$La\",null,{\"href\":\"https://reactjs.org/docs/hooks-intro.html\",\"children\":\"Hooks proposal API\"}],\", they often wonder: how does \",[\"$\",\"code\",null,{\"children\":\"useState\"}],\" “know what to do”? The assumption is that it’s more “magical” than a base \",[\"$\",\"code\",null,{\"children\":\"React.Component\"}],\" class with \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"But as we have seen today, the base class \",[\"$\",\"code\",null,{\"children\":\"setState()\"}],\" implementation has been an illusion all along. It doesn’t do anything except forwarding the call to the current renderer. And \",[\"$\",\"code\",null,{\"children\":\"useState\"}],\" Hook \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactHooks.js#L55-L56\",\"children\":\"does exactly the same thing\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"Instead of an \",[\"$\",\"code\",null,{\"children\":\"updater\"}],\" field, Hooks use a “dispatcher” object.\"]}],\" When you call \",[\"$\",\"code\",null,{\"children\":\"React.useState()\"}],\", \",[\"$\",\"code\",null,{\"children\":\"React.useEffect()\"}],\", or another built-in Hook, these calls are forwarded to the current dispatcher.\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// In React (simplified a bit)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Real property is hidden a bit deeper, see if you can find it!\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"initialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"    return React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"initialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useEffect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"initialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"    return React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useEffect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"initialState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// ...\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"And individual renderers set the dispatcher before rendering your component:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// In React DOM\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"prevDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" ReactDOMDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"try\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  result \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"YourComponent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"finally\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Restore it back\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"__currentDispatcher \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" prevDispatcher\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For example, the React DOM Server implementation is \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRendererHooks.js#L340-L354\",\"children\":\"here\"}],\", and the reconciler implementation shared by React DOM and React Native is \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberHooks.js\",\"children\":\"here\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This is why a renderer such as \",[\"$\",\"code\",null,{\"children\":\"react-dom\"}],\" needs to access the same \",[\"$\",\"code\",null,{\"children\":\"react\"}],\" package that you call Hooks from. Otherwise, your component won’t “see” the dispatcher! This may not work when you have \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/issues/13991\",\"children\":\"multiple copies of React\"}],\" in the same component tree. However, this has always led to obscure bugs so Hooks force you to solve the package duplication before it costs you.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"While we don’t encourage this, you can technically override the dispatcher yourself for advanced tooling use cases. (I lied about  \",[\"$\",\"code\",null,{\"children\":\"__currentDispatcher\"}],\" name but you can find the real one in the React repo.) For example, React DevTools will use \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-debug-tools/src/ReactDebugHooks.js#L203-L214\",\"children\":\"a special purpose-built dispatcher\"}],\" to introspect the Hooks tree by capturing JavaScript stack traces. \",[\"$\",\"em\",null,{\"children\":\"Don’t repeat this at home.\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This also means Hooks aren’t inherently tied to React. If in the future more libraries want to reuse the same primitive Hooks, in theory the dispatcher could move to a separate package and be exposed as a first-class API with a less “scary” name. In practice, we’d prefer to avoid premature abstraction until there is a need for it.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Both the \",[\"$\",\"code\",null,{\"children\":\"updater\"}],\" field and the \",[\"$\",\"code\",null,{\"children\":\"__currentDispatcher\"}],\" object are forms of a generic programming principle called \",[\"$\",\"em\",null,{\"children\":\"dependency injection\"}],\". In both cases, the renderers “inject” implementations of features like \",[\"$\",\"code\",null,{\"children\":\"setState\"}],\" into the generic React package to keep your components more declarative.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You don’t need to think about how this works when you use React. We’d like React users to spend more time thinking about their application code than abstract concepts like dependency injection. But if you’ve ever wondered how \",[\"$\",\"code\",null,{\"children\":\"this.setState()\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"useState()\"}],\" know what to do, I hope this helps.\"]}]]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>