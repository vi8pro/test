<!DOCTYPE html><html lang="en" class="__className_e34cb4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://github.com/gaearon.png"/><link rel="stylesheet" href="/_next/static/css/0f6647b39fdbcb3d.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3c6c21fa7f32edf2.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f9d4d708579596e8.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-da4818c833129d2a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-44c3d350117a997d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-74b5bca37634105e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/569-52e5d813bbfa85ea.js" async=""></script><script src="/_next/static/chunks/app/layout-cfb37acb14684668.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js" async=""></script><title>Why Do React Elements Have a $$typeof Property? ‚Äî overreacted</title><meta name="description" content="It has something to do with security."/><link rel="icon" href="/icon.png?e0852c1e2c7f0e65" type="image/png" sizes="329x329"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]"><header class="mb-14 flex flex-row place-content-between"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a><span class="relative top-[4px] italic">by<!-- --> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://danabra.mov"><img alt="Dan Abramov" src="https://github.com/gaearon.png" class="relative -top-1 mx-1 inline h-8 w-8 rounded-full"/></a></span></header><main><article><h1 class="__className_b47211 text-[40px] font-black leading-[44px] text-[--title]">Why Do React Elements Have a $$typeof Property?</h1><p class="mt-2 text-[13px] text-gray-700 dark:text-gray-300">December 3, 2018</p><div class="markdown mt-10"><p>You might think you‚Äôre writing JSX:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">marquee</span><span style="color:#C792EA"> bgcolor=</span><span style="color:#C792EA">&quot;</span><span style="color:#ECC48D">#ffa7c4</span><span style="color:#C792EA">&quot;</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">hi</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">marquee</span><span style="color:#C792EA">&gt;</span></span></code></pre></div>
<p>But really, you‚Äôre calling a function:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">React</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">createElement</span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">/* type */</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">marquee</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">/* props */</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> bgcolor</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">#ffa7c4</span><span style="color:#C792EA">&#x27;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">/* children */</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">hi</span><span style="color:#C792EA">&#x27;</span></span>
<span data-line=""><span style="color:#C792EA">)</span></span></code></pre></div>
<p>And that function gives you back an object. We call this object a React <em>element</em>. It tells React what to render next. Your components return a tree of them.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  type: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">marquee</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  props: </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    bgcolor: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">#ffa7c4</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">    children: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">hi</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">  key: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  ref: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  $$typeof: </span><span style="color:#FFA7C4">Symbol</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">for</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react.element</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">),</span><span style="color:#CED2D6"> </span><span style="color:#637777">// üßê Who dis</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>If you used React you might be familiar with <code>type</code>, <code>props</code>, <code>key</code>, and <code>ref</code> fields. <strong>But what is <code>$$typeof</code>? And why does it have a <code>Symbol()</code> as a value?</strong></p>
<p>That‚Äôs another one of those things that you don‚Äôt <em>need</em> to know to use React, but that will make you feel good when you do. There‚Äôs also some tips about security in this post that you might want to know. Maybe one day you‚Äôll write your own UI library and all of this will come in handy. I certainly hope so.</p>
<hr/>
<p>Before client-side UI libraries became common and added basic protection, it was common for app code to construct HTML and insert it into the DOM:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">messageEl</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> document</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">getElementById</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">message</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#FFA7C4">messageEl</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">innerHTML </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">&lt;p&gt;</span><span style="color:#C792EA">&#x27;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">+</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">message</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">text </span><span style="color:#C792EA">+</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">&lt;/p&gt;</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">;</span></span></code></pre></div>
<p>That works fine, except when your <code>message.text</code> is something like <code>&#x27;&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;&#x27;</code>. <strong>You don‚Äôt want things written by strangers to appear verbatim in your app‚Äôs rendered HTML.</strong></p>
<p>(Fun fact: if you only do client-side rendering, a <code>&lt;script&gt;</code> tag here wouldn‚Äôt let you run JavaScript. But <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/">don‚Äôt let this</a> lull you into a false sense of security.)</p>
<p>To protect against such attacks, you can use safe APIs like <code>document.createTextNode()</code> or <code>textContent</code> that only deal with text. You can also preemptively ‚Äúescape‚Äù inputs by replacing potentially dangerous characters like <code>&lt;</code>, <code>&gt;</code> and others in any user-provided text.</p>
<p>Still, the cost of a mistake is high and it‚Äôs a hassle to remember it every time you interpolate a user-written string into your output. <strong>This is why modern libraries like React escape text content for strings by default:</strong></p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">{</span><span style="color:#FFA7C4">message</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">text</span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span></code></pre></div>
<p>If <code>message.text</code> is a malicious string with an <code>&lt;img&gt;</code> or another tag, it won‚Äôt turn into a real <code>&lt;img&gt;</code> tag. React will escape the content and <em>then</em> insert it into the DOM. So instead of seeing the <code>&lt;img&gt;</code> tag you‚Äôll just see its markup.</p>
<p>To render arbitrary HTML inside a React element, you have to write <code>dangerouslySetInnerHTML={{ __html: message.text }}</code>. <strong>The fact that it‚Äôs clumsy to write is a <em>feature</em>.</strong> It‚Äôs meant to be highly visible so that you can catch it in code reviews and codebase audits.</p>
<hr/>
<p><strong>Does it mean React is entirely safe from injection attacks? No.</strong> HTML and DOM offer <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/issues/3473#issuecomment-90594748">plenty of attack surface</a> that is too difficult or slow for React or other UI libraries to mitigate against. Most of the remaining attack vectors involve attributes. For example, if you render <code>&lt;a href={user.website}&gt;</code>, beware of the user whose website is <code>&#x27;javascript: stealYourPassword()&#x27;</code>. Spreading user input like <code>&lt;div {...userData}&gt;</code> is rare but also dangerous.</p>
<p>React <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/issues/10506">could</a> provide more protection over time but in many cases these are consequences of server issues that <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/issues/3473#issuecomment-91327040">should</a> be fixed there anyway.</p>
<p>Still, escaping text content is a reasonable first line of defence that catches a lot of potential attacks. Isn‚Äôt it nice to know that code like this is safe?</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// Escaped automatically</span></span>
<span data-line=""><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">{</span><span style="color:#FFA7C4">message</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">text</span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span></code></pre></div>
<p><strong>Well, that wasn‚Äôt always true either.</strong> And that‚Äôs where <code>$$typeof</code> comes in.</p>
<hr/>
<p>React elements are plain objects by design:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  type: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">marquee</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  props: </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    bgcolor: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">#ffa7c4</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">    children: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">hi</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">  key: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  ref: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  $$typeof: </span><span style="color:#FFA7C4">Symbol</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">for</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react.element</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">),</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>While normally you create them with <code>React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldn‚Äôt <em>want</em> to write them like this ‚Äî but this <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/pull/3583#issuecomment-90296667">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>
<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#637777">// Server could have a hole that lets user store JSON</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">let </span><span style="color:#CED2D6">expectedTextButGotJSON</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">  </span><span style="color:#CED2D6">type</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">div</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">  </span><span style="color:#CED2D6">props</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">    dangerouslySetInnerHTML</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      __html</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">/* put your exploit here */</span><span style="color:#C792EA">&#x27;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">},</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">},</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">  </span><span style="color:#637777">// ...</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#FFA7C4">let </span><span style="color:#CED2D6">message</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">{</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">text</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> expectedTextButGotJSON </span><span style="color:#C792EA">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#637777">// Dangerous in React 0.13</span></span>
<span data-line=""><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">{</span><span style="color:#FFA7C4">message</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">text</span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span></code></pre></div>
<p>In that case, React 0.13 would be <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="http://danlec.com/blog/xss-via-a-spoofed-react-element">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>
<p>The fix in React 0.14 was to <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/pull/4832">tag every React element with a Symbol</a>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  type: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">marquee</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  props: </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    bgcolor: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">#ffa7c4</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">    children: </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">hi</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">  key: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">  ref: </span><span style="color:#F87086">null</span><span style="color:#C792EA">,</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  $$typeof: </span><span style="color:#FFA7C4">Symbol</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">for</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react.element</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">),</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>This works because you can‚Äôt just put <code>Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON can‚Äôt include <code>Symbol.for(&#x27;react.element&#x27;)</code>.</strong> React will check <code>element.$$typeof</code>, and will refuse to process the element if it‚Äôs missing or invalid.</p>
<p>The nice thing about using <code>Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesn‚Äôt prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still ‚Äúagree‚Äù on the valid <code>$$typeof</code> value.</p>
<hr/>
<p>What about the browsers that <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility">don‚Äôt support</a> Symbols?</p>
<p>Alas, they don‚Äôt get this extra protection. React still includes the <code>$$typeof</code> field on the element for consistency, but it‚Äôs <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16">set to a number</a> ‚Äî <code>0xeac7</code>.</p>
<p>Why this number specifically? <code>0xeac7</code> kinda looks like ‚ÄúReact‚Äù.</p><hr/><p><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fwhy-do-react-elements-have-typeof-property%2F">Discuss on ùïè</a>¬†¬†¬∑¬†¬†<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/gaearon/overreacted.io/edit/main/public/why-do-react-elements-have-typeof-property/index.md">Edit on GitHub</a></p></div></article><footer class="mt-12"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a></footer></main><script src="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/0f6647b39fdbcb3d.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/3c6c21fa7f32edf2.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/f9d4d708579596e8.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[3728,[],\"\"]\n7:I[9928,[],\"\"]\n8:I[4982,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"185\",\"static/chunks/app/layout-cfb37acb14684668.js\"],\"\"]\n9:I[8256,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"64\",\"static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js\"],\"\"]\na:I[2008,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js\"],\"\"]\nb:I[6954,[],\"\"]\nc:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f6647b39fdbcb3d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"iWWiOWlg3tDiHen4DuUO-\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/why-do-react-elements-have-typeof-property/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"why-do-react-elements-have-typeof-property\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"why-do-react-elements-have-typeof-property\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"$L8\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__className_e34cb4\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-14 flex flex-row place-content-between\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"span\",null,{\"className\":\"relative top-[4px] italic\",\"children\":[\"by\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://danabra.mov\",\"target\":\"_blank\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Dan Abramov\",\"src\":\"https://github.com/gaearon.png\",\"className\":\"relative -top-1 mx-1 inline h-8 w-8 rounded-full\"}]}]]}]]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"article\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Not found\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[[\"$\",\"p\",null,{\"children\":\"This page doesn't exist (yet?)\"}],[\"$\",\"p\",null,{\"children\":[\"I recently rewrote the site so maybe something broke. Please\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/issues/796\",\"children\":\"complain here.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If you're looking for translated posts, they're not on the site anymore but you can find\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/tree/archive/src/pages\",\"children\":\"an archive of them here.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Hope you'll find what you're looking for.\"}]]}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"childProp\":{\"current\":[null,[[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",[\"slug\",\"why-do-react-elements-have-typeof-property\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",\"$Le\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"why-do-react-elements-have-typeof-property\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-12\",\"children\":[\"$\",\"$L9\",null,{}]}]],null],\"segment\":[\"slug\",\"why-do-react-elements-have-typeof-property\",\"d\"]},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3c6c21fa7f32edf2.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"article\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Why Do React Elements Have a $$typeof Property?\"}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-[13px] text-gray-700 dark:text-gray-300\",\"children\":\"December 3, 2018\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[\"$Lf\",[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"$La\",null,{\"href\":\"https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fwhy-do-react-elements-have-typeof-property%2F\",\"children\":\"Discuss on ùïè\"}],\"¬†¬†¬∑¬†¬†\",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/edit/main/public/why-do-react-elements-have-typeof-property/index.md\",\"children\":\"Edit on GitHub\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"p\",null,{\"children\":\"You might think you‚Äôre writing JSX:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" bgcolor=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"#ffa7c4\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"hi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But really, you‚Äôre calling a function:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"React\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"createElement\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"/* type */\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"/* props */\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" bgcolor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"#ffa7c4\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"/* children */\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"hi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"And that function gives you back an object. We call this object a React \",[\"$\",\"em\",null,{\"children\":\"element\"}],\". It tells React what to render next. Your components return a tree of them.\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  type: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  props: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    bgcolor: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"#ffa7c4\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    children: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"hi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  key: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  ref: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  $$typeof: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Symbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react.element\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"),\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// üßê Who dis\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you used React you might be familiar with \",[\"$\",\"code\",null,{\"children\":\"type\"}],\", \",[\"$\",\"code\",null,{\"children\":\"props\"}],\", \",[\"$\",\"code\",null,{\"children\":\"key\"}],\", and \",[\"$\",\"code\",null,{\"children\":\"ref\"}],\" fields. \",[\"$\",\"strong\",null,{\"children\":[\"But what is \",[\"$\",\"code\",null,{\"children\":\"$$$typeof\"}],\"? And why does it have a \",[\"$\",\"code\",null,{\"children\":\"Symbol()\"}],\" as a value?\"]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"That‚Äôs another one of those things that you don‚Äôt \",[\"$\",\"em\",null,{\"children\":\"need\"}],\" to know to use React, but that will make you feel good when you do. There‚Äôs also some tips about security in this post that you might want to know. Maybe one day you‚Äôll write your own UI library and all of this will come in handy. I certainly hope so.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Before client-side UI libraries became common and added basic protection, it was common for app code to construct HTML and insert it into the DOM:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"messageEl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" document\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"getElementById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"messageEl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"innerHTML \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"\u003cp\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"text \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"\u003c/p\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"That works fine, except when your \",[\"$\",\"code\",null,{\"children\":\"message.text\"}],\" is something like \",[\"$\",\"code\",null,{\"children\":\"'\u003cimg src onerror=\\\"stealYourPassword()\\\"\u003e'\"}],\". \",[\"$\",\"strong\",null,{\"children\":\"You don‚Äôt want things written by strangers to appear verbatim in your app‚Äôs rendered HTML.\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"(Fun fact: if you only do client-side rendering, a \",[\"$\",\"code\",null,{\"children\":\"\u003cscript\u003e\"}],\" tag here wouldn‚Äôt let you run JavaScript. But \",[\"$\",\"$La\",null,{\"href\":\"https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/\",\"children\":\"don‚Äôt let this\"}],\" lull you into a false sense of security.)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To protect against such attacks, you can use safe APIs like \",[\"$\",\"code\",null,{\"children\":\"document.createTextNode()\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"textContent\"}],\" that only deal with text. You can also preemptively ‚Äúescape‚Äù inputs by replacing potentially dangerous characters like \",[\"$\",\"code\",null,{\"children\":\"\u003c\"}],\", \",[\"$\",\"code\",null,{\"children\":\"\u003e\"}],\" and others in any user-provided text.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Still, the cost of a mistake is high and it‚Äôs a hassle to remember it every time you interpolate a user-written string into your output. \",[\"$\",\"strong\",null,{\"children\":\"This is why modern libraries like React escape text content for strings by default:\"}]]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If \",[\"$\",\"code\",null,{\"children\":\"message.text\"}],\" is a malicious string with an \",[\"$\",\"code\",null,{\"children\":\"\u003cimg\u003e\"}],\" or another tag, it won‚Äôt turn into a real \",[\"$\",\"code\",null,{\"children\":\"\u003cimg\u003e\"}],\" tag. React will escape the content and \",[\"$\",\"em\",null,{\"children\":\"then\"}],\" insert it into the DOM. So instead of seeing the \",[\"$\",\"code\",null,{\"children\":\"\u003cimg\u003e\"}],\" tag you‚Äôll just see its markup.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To render arbitrary HTML inside a React element, you have to write \",[\"$\",\"code\",null,{\"children\":\"dangerouslySetInnerHTML={{ __html: message.text }}\"}],\". \",[\"$\",\"strong\",null,{\"children\":[\"The fact that it‚Äôs clumsy to write is a \",[\"$\",\"em\",null,{\"children\":\"feature\"}],\".\"]}],\" It‚Äôs meant to be highly visible so that you can catch it in code reviews and codebase audits.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Does it mean React is entirely safe from injection attacks? No.\"}],\" HTML and DOM offer \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/issues/3473#issuecomment-90594748\",\"children\":\"plenty of attack surface\"}],\" that is too difficult or slow for React or other UI libraries to mitigate against. Most of the remaining attack vectors involve attributes. For example, if you render \",[\"$\",\"code\",null,{\"children\":\"\u003ca href={user.website}\u003e\"}],\", beware of the user whose website is \",[\"$\",\"code\",null,{\"children\":\"'javascript: stealYourPassword()'\"}],\". Spreading user input like \",[\"$\",\"code\",null,{\"children\":\"\u003cdiv {...userData}\u003e\"}],\" is rare but also dangerous.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"React \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/issues/10506\",\"children\":\"could\"}],\" provide more protection over time but in many cases these are consequences of server issues that \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/issues/3473#issuecomment-91327040\",\"children\":\"should\"}],\" be fixed there anyway.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Still, escaping text content is a reasonable first line of defence that catches a lot of potential attacks. Isn‚Äôt it nice to know that code like this is safe?\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Escaped automatically\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Well, that wasn‚Äôt always true either.\"}],\" And that‚Äôs where \",[\"$\",\"code\",null,{\"children\":\"$$$typeof\"}],\" comes in.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"React elements are plain objects by design:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  type: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  props: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    bgcolor: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"#ffa7c4\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    children: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"hi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  key: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  ref: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  $$typeof: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Symbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react.element\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"While normally you create them with \",[\"$\",\"code\",null,{\"children\":\"React.createElement()\"}],\", it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldn‚Äôt \",[\"$\",\"em\",null,{\"children\":\"want\"}],\" to write them like this ‚Äî but this \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/pull/3583#issuecomment-90296667\",\"children\":\"can be\"}],\" useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, \",[\"$\",\"strong\",null,{\"children\":\"if your server has a hole that lets the user store an arbitrary JSON object\"}],\" while the client code expects a string, this could become a problem:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Server could have a hole that lets user store JSON\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"expectedTextButGotJSON\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"props\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    dangerouslySetInnerHTML\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      __html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"/* put your exploit here */\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// ...\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" expectedTextButGotJSON \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Dangerous in React 0.13\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In that case, React 0.13 would be \",[\"$\",\"$La\",null,{\"href\":\"http://danlec.com/blog/xss-via-a-spoofed-react-element\",\"children\":\"vulnerable\"}],\" to an XSS attack. To clarify, again, \",[\"$\",\"strong\",null,{\"children\":\"this attack depends on an existing server hole\"}],\". Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The fix in React 0.14 was to \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/pull/4832\",\"children\":\"tag every React element with a Symbol\"}],\":\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  type: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"marquee\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  props: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    bgcolor: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"#ffa7c4\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    children: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"hi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  key: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  ref: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  $$typeof: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Symbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react.element\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This works because you can‚Äôt just put \",[\"$\",\"code\",null,{\"children\":\"Symbol\"}],\"s in JSON. \",[\"$\",\"strong\",null,{\"children\":[\"So even if the server has a security hole and returns JSON instead of text, that JSON can‚Äôt include \",[\"$\",\"code\",null,{\"children\":\"Symbol.for('react.element')\"}],\".\"]}],\" React will check \",[\"$\",\"code\",null,{\"children\":\"element.$$typeof\"}],\", and will refuse to process the element if it‚Äôs missing or invalid.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The nice thing about using \",[\"$\",\"code\",null,{\"children\":\"Symbol.for()\"}],\" specifically is that \",[\"$\",\"strong\",null,{\"children\":\"Symbols are global between environments like iframes and workers.\"}],\" So this fix doesn‚Äôt prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still ‚Äúagree‚Äù on the valid \",[\"$\",\"code\",null,{\"children\":\"$$$typeof\"}],\" value.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"What about the browsers that \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility\",\"children\":\"don‚Äôt support\"}],\" Symbols?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Alas, they don‚Äôt get this extra protection. React still includes the \",[\"$\",\"code\",null,{\"children\":\"$$$typeof\"}],\" field on the element for consistency, but it‚Äôs \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16\",\"children\":\"set to a number\"}],\" ‚Äî \",[\"$\",\"code\",null,{\"children\":\"0xeac7\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Why this number specifically? \",[\"$\",\"code\",null,{\"children\":\"0xeac7\"}],\" kinda looks like ‚ÄúReact‚Äù.\"]}]]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Why Do React Elements Have a $$typeof Property? ‚Äî overreacted\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"It has something to do with security.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/icon.png?e0852c1e2c7f0e65\",\"type\":\"image/png\",\"sizes\":\"329x329\"}]]\nd:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>