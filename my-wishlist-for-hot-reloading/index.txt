1:HL["/_next/static/css/0f6647b39fdbcb3d.css","style",{"crossOrigin":""}]
0:["iWWiOWlg3tDiHen4DuUO-",[[["",{"children":[["slug","my-wishlist-for-hot-reloading","d"],{"children":["__PAGE__?{\"slug\":\"my-wishlist-for-hot-reloading\"}",{}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/0f6647b39fdbcb3d.css","precedence":"next","crossOrigin":""}]],"$L3"]]]]
4:HL["/_next/static/css/3c6c21fa7f32edf2.css","style",{"crossOrigin":""}]
5:HL["/_next/static/css/f9d4d708579596e8.css","style",{"crossOrigin":""}]
6:I[4982,["569","static/chunks/569-52e5d813bbfa85ea.js","185","static/chunks/app/layout-cfb37acb14684668.js"],""]
7:I[8256,["569","static/chunks/569-52e5d813bbfa85ea.js","64","static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js"],""]
8:I[2008,["569","static/chunks/569-52e5d813bbfa85ea.js","42","static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js"],""]
9:I[6954,[],""]
a:I[7264,[],""]
2:[null,["$","$L6",null,{"children":["$","html",null,{"lang":"en","className":"__className_e34cb4","children":["$","body",null,{"className":"mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]","children":[["$","header",null,{"className":"mb-14 flex flex-row place-content-between","children":[["$","$L7",null,{}],["$","span",null,{"className":"relative top-[4px] italic","children":["by"," ",["$","$L8",null,{"href":"https://danabra.mov","target":"_blank","children":["$","img",null,{"alt":"Dan Abramov","src":"https://github.com/gaearon.png","className":"relative -top-1 mx-1 inline h-8 w-8 rounded-full"}]}]]}]]}],["$","main",null,{"children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","article",null,{"className":"markdown","children":[["$","h1",null,{"className":"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]","children":"Not found"}],["$","div",null,{"className":"markdown mt-10","children":[["$","p",null,{"children":"This page doesn't exist (yet?)"}],["$","p",null,{"children":["I recently rewrote the site so maybe something broke. Please"," ",["$","$L8",null,{"href":"https://github.com/gaearon/overreacted.io/issues/796","children":"complain here."}]]}],["$","p",null,{"children":["If you're looking for translated posts, they're not on the site anymore but you can find"," ",["$","$L8",null,{"href":"https://github.com/gaearon/overreacted.io/tree/archive/src/pages","children":"an archive of them here."}]]}],["$","p",null,{"children":"Hope you'll find what you're looking for."}]]}]]}],"notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f9d4d708579596e8.css","precedence":"next","crossOrigin":""}]],"childProp":{"current":[null,[["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children",["slug","my-wishlist-for-hot-reloading","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb","$Lc",null],"segment":"__PAGE__?{\"slug\":\"my-wishlist-for-hot-reloading\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f9d4d708579596e8.css","precedence":"next","crossOrigin":""}]]}],["$","footer",null,{"className":"mt-12","children":["$","$L7",null,{}]}]],null],"segment":["slug","my-wishlist-for-hot-reloading","d"]},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3c6c21fa7f32edf2.css","precedence":"next","crossOrigin":""}]]}]}]]}]}]}],null]
c:["$","article",null,{"children":[["$","h1",null,{"className":"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]","children":"My Wishlist for Hot Reloading"}],["$","p",null,{"className":"mt-2 text-[13px] text-gray-700 dark:text-gray-300","children":"December 8, 2018"}],["$","div",null,{"className":"markdown mt-10","children":["$Ld",["$","hr",null,{}],["$","p",null,{"children":[["$","$L8",null,{"href":"https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fmy-wishlist-for-hot-reloading%2F","children":"Discuss on ùïè"}],"¬†¬†¬∑¬†¬†",["$","$L8",null,{"href":"https://github.com/gaearon/overreacted.io/edit/main/public/my-wishlist-for-hot-reloading/index.md","children":"Edit on GitHub"}]]}]]}]]}]
3:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"My Wishlist for Hot Reloading ‚Äî overreacted"}],["$","meta","3",{"name":"description","content":"I don't want a lot for Christmas. There is just one thing I need."}],["$","link","4",{"rel":"icon","href":"/icon.png?e0852c1e2c7f0e65","type":"image/png","sizes":"329x329"}]]
b:null
d:[["$","p",null,{"children":"Do you have a project that you approach repeatedly with a mix of success and failure, step aside for a while, and then try again ‚Äî year after year? For some, it might be a router or a virtual list scroller. For me, it‚Äôs hot reloading."}],"\n",["$","p",null,{"children":["My first exposure to the idea of changing code on the fly was a brief mention in a book about Erlang that I read as a teenager. Much later, like many others, I fell in love with ",["$","$L8",null,{"href":"https://vimeo.com/36579366","children":"Bret Victor‚Äôs beautiful demos"}],". I‚Äôve read somewhere Bret was unhappy with people cherry-picking ‚Äúeasy‚Äù parts of his demos and screwing up the big vision. (I don‚Äôt know if this is true.) ",["$","strong",null,{"children":"In either case, to me shipping even small incremental improvements that people take for granted later is a success."}]," Smarter people than me will work on Next Big Ideas."]}],"\n",["$","p",null,{"children":["Now, I want to be clear that none of the ",["$","em",null,{"children":"ideas"}]," discussed in this post are mine. I‚Äôve been ",["$","$L8",null,{"href":"https://redux.js.org/introduction/prior-art","children":"inspired"}]," by many projects and people. In fact, even people whose projects I‚Äôve never tried occasionally told me I‚Äôve ripped off their stuff."]}],"\n",["$","p",null,{"children":"I‚Äôm not an inventor. If I have a ‚Äúprinciple‚Äù, it is to take a vision that inspires me, and share it with more people ‚Äî through words, code, and demos."}],"\n",["$","p",null,{"children":"And hot reloading inspires me."}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":"I‚Äôve taken several attempts at implementing hot reloading for React."}],"\n",["$","p",null,{"children":["In retrospect, ",["$","$L8",null,{"href":"https://vimeo.com/100010922","children":"the first demo"}]," I cobbled together changed my life. It got me my first Twitter followers, first thousand GitHub stars, later first ",["$","$L8",null,{"href":"https://news.ycombinator.com/item?id=8982620","children":"HN frontpage"}]," hit, and even my first ",["$","$L8",null,{"href":"https://www.youtube.com/watch?v=xsSnOQynTHs","children":"conference talk"}]," (bringing Redux into existence, oops). This first iteration worked fairly well. However, soon React moved ",["$","em",null,{"children":"away"}]," from ",["$","code",null,{"children":"createClass"}],", making a reliable implementation much more difficult."]}],"\n",["$","p",null,{"children":["Since then I‚Äôve done ",["$","$L8",null,{"href":"https://medium.com/@dan_abramov/hot-reloading-in-react-1140438583bf?source=user_profile---------6------------------","children":"a few more attempts"}]," to fix it, each flawed in a different way. One of them is still being used in React Native (hot reloading functions doesn‚Äôt work there because of my mistakes ‚Äî sorry!)"]}],"\n",["$","p",null,{"children":"Frustrated with my inability to work around some issues and the lack of time, I handed React Hot Loader over to a few talented contributors. They have been pushing it forward and found clever workarounds for my design flaws. I am grateful to them for keeping the project in a good state despite the challenges."}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"To be clear, hot reloading in React is quite usable today."}]," In fact, this blog uses Gatsby which uses React Hot Loader under the hood. I save this post in my editor and it updates without refreshing. Magic! In some ways, the vision that I worried wouldn‚Äôt ever see mainstream usage is already almost boring."]}],"\n",["$","p",null,{"children":["But there are plenty of people who feel it isn‚Äôt as good as it could be. Some dismiss it as a gimmick and that breaks my heart a little bit, but I think what they‚Äôre really saying is: ",["$","strong",null,{"children":"the experience is not seamless."}]," It‚Äôs not worth it if you‚Äôre never sure whether a hot reload worked, if it breaks in confusing ways, or if it‚Äôs easier to just refresh. I agree with this 100%, but to me it means we have more work to do. And I‚Äôm excited to start thinking about what official React support for hot reloading could look like in the future."]}],"\n",["$","p",null,{"children":"(If you use a language like Elm, Reason or ClojureScript, maybe those problems are already solved in your ecosystem. I‚Äôm happy that you‚Äôre happy. This won‚Äôt stop me from trying and failing to bring good stuff to JavaScript.)"}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":"I think I‚Äôm ready to take another attempt at implementing it. Here‚Äôs why."}],"\n",["$","p",null,{"children":["Ever since ",["$","code",null,{"children":"createClass"}]," stopped being the primary way we define components, ",["$","strong",null,{"children":"the biggest source of complexity and fragility in hot reloading components was dynamically replacing class methods."}]," How do you patch existing instances of classes with new ‚Äúversions‚Äù of their methods? The simple answer is ‚Äúreplace them on the prototype‚Äù but even with Proxies, in my experience there are too many gnarly edge cases for this to work reliably."]}],"\n",["$","p",null,{"children":"By comparison, hot reloading functions is easy. A Babel plugin could split any function component exported from a module into two functions:"}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"Overnight","style":{"backgroundColor":"var(--code-bg)"},"tabIndex":"0","data-language":"jsx","data-theme":"default","children":["$","code",null,{"data-language":"jsx","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// Reassigns the latest version"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFA7C4"},"children":"window"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"latest_Button"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"="}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"function"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":")"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#637777"},"children":"// Your actual code is moved here by a plugin"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"return"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"<"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":">"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"Hello"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"</"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":">;"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#C792EA"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// Think of this as a \"proxy\""}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// that other components would use"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFA7C4"},"children":"export"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"default"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"function"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"Button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":")"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#637777"},"children":"// Always points to latest version"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"return"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"window"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"latest_Button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#C792EA"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":["Every time this module re-executes after an edit, ",["$","code",null,{"children":"window.latest_Button"}]," would point to the latest implementation. Reusing the same ",["$","code",null,{"children":"Button"}]," function between module evaluations would let us trick React into not unmounting our component even though we swapped out the implementation."]}],"\n",["$","p",null,{"children":["For a long time, it seemed to me that implementing reliable hot reloading for functions ",["$","em",null,{"children":"alone"}]," would encourage people to write convoluted code just to avoid using classes. But with ",["$","$L8",null,{"href":"https://reactjs.org/docs/hooks-intro.html","children":"Hooks"}],", function components are fully featured so this is not a concern anymore. And this approach ‚Äújust works‚Äù with Hooks:"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"Overnight","style":{"backgroundColor":"var(--code-bg)"},"tabIndex":"0","data-language":"jsx","data-theme":"default","children":["$","code",null,{"data-language":"jsx","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// Reassigns the latest version"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFA7C4"},"children":"window"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"latest_Button"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"="}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"function"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":")"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#637777"},"children":"// Your actual code is moved here by a plugin"}]]}],"\n",["$","span",null,{"data-line":"","data-highlighted-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"const ["}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"name"}],["$","span",null,{"style":{"color":"#C792EA"},"children":","}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":" "}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"setName"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"] "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"="}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":" "}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"useState"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#C792EA"},"children":"'"}],["$","span",null,{"style":{"color":"#ECC48D"},"children":"Mary"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"'"}],["$","span",null,{"style":{"color":"#C792EA"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"const "}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"handleChange"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"="}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":" "}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"e"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":" => "}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"setName"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"e"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"target"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"value"}],["$","span",null,{"style":{"color":"#C792EA"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"return"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"    "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"<>"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"      "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"<"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"input"}],["$","span",null,{"style":{"color":"#C792EA"},"children":" value={"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"name"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"} onChange={"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"handleChange"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"} />"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"      "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"<"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"h1"}],["$","span",null,{"style":{"color":"#C792EA"},"children":">"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"Hello, "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"{"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"name"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"}</"}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"h1"}],["$","span",null,{"style":{"color":"#C792EA"},"children":">"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"    "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"</>"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#C792EA"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#C792EA"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// Think of this as a \"proxy\""}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#637777"},"children":"// that other components would use"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFA7C4"},"children":"export"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"default"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"function"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"Button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":")"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#C792EA"},"children":"{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#637777"},"children":"// Always points to latest version"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#CED2D6"},"children":"  "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"return"}],["$","span",null,{"style":{"color":"#CED2D6"},"children":" "}],["$","span",null,{"style":{"color":"#FFA7C4"},"children":"window"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"."}],["$","span",null,{"style":{"color":"#8EACE3"},"children":"latest_Button"}],["$","span",null,{"style":{"color":"#C792EA"},"children":"("}],["$","span",null,{"style":{"color":"#CED2D6"},"children":"props"}],["$","span",null,{"style":{"color":"#C792EA"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#C792EA"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":["As long as the Hook call order doesn‚Äôt change, we can preserve the state even as ",["$","code",null,{"children":"window.latest_Button"}]," is replaced between file edits. And replacing event handlers ‚Äújust works‚Äù too ‚Äî because Hooks rely on closures, and we replace the whole function."]}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":"This was just a rough sketch of one possible approach. There are more (some are very different). How do we evaluate and compare them?"}],"\n",["$","p",null,{"children":["Before I get too attached to a specific approach that might be flawed in some way, ",["$","strong",null,{"children":"I decided to write down a few principles that I think are important for judging any hot reloading implementation for component code."}]]}],"\n",["$","p",null,{"children":"It would be nice to express some of these principles as tests later. These rules aren‚Äôt strict and there might be reasonable compromises. But if we decide to break them, that should be an explicit design decision and not something we accidentally discover later."}],"\n",["$","p",null,{"children":"Here goes my wish list for hot reloading React components:"}],"\n",["$","h3",null,{"children":"Correctness"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Hot reloading should be unobservable before the first edit."}]," Until you save a file, the code should behave exactly as it would if hot reloading was disabled. It‚Äôs expected that things like ",["$","code",null,{"children":"fn.toString()"}]," don‚Äôt match, which is already the case with minification. But it shouldn‚Äôt break reasonable application and library logic."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Hot reload shouldn‚Äôt break React rules."}]," Components shouldn‚Äôt get their lifecycles called in an unexpected way, accidentally swap state between unrelated trees, or do other non-Reacty things."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Element type should always match the expected type."}]," Some approaches wrap component types but this can break ",["$","code",null,{"children":"<MyThing />.type === MyThing"}],". This is a common source of bugs and should not happen."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"It should be easy to support all React types."}]," ",["$","code",null,{"children":"lazy"}],", ",["$","code",null,{"children":"memo"}],", ",["$","code",null,{"children":"forwardRef"}]," ‚Äî they should all be supported and it shouldn‚Äôt be hard to add support for more. Nested variations like ",["$","code",null,{"children":"memo(memo(...))"}]," should also work. We should always remount when the type shape changes."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"It shouldn‚Äôt reimplement a non-trivial chunk of React."}]," It‚Äôs hard to keep up with React. If a solution reimplements React it poses problems in longer term as React adds features like Suspense."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Re-exports shouldn‚Äôt break."}]," If a component re-exports components from other modules (whether own or from ",["$","code",null,{"children":"node_modules"}],"), that shouldn‚Äôt cause issues."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Static fields shouldn‚Äôt break."}]," If you define a ",["$","code",null,{"children":"ProfilePage.onEnter"}]," method, you‚Äôd expect an importing module to be able to read it. Sometimes libraries rely on this so it‚Äôs important that it‚Äôs possible to read and write static properties, and for component itself to ‚Äúsee‚Äù the same values on itself."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"It is better to lose local state than to behave incorrectly."}]," If we can‚Äôt reliably patch something (for example, a class), it is better to lose its local state than to do a mixed success effort at updating it. The developer will be suspicious anyway and likely force a refresh. We should be intentional about which cases we‚Äôre confident we can handle, and discard the rest."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"It is better to lose local state than use an old version."}]," This is a more specific variation of the previous principle. For example, if a class couldn‚Äôt be hot reloaded, the code should force a remount for those components with the new version rather than keep rendering a zombie."]}],"\n"]}],"\n"]}],"\n",["$","h3",null,{"children":"Locality"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Editing a module should re-execute as few modules as possible."}]," Side effects during component module initialization are generally discouraged. But the more code you execute, the more likely something will cause a mess when called twice. We‚Äôre writing JavaScript, and React components are islands of (relative) purity but even there we don‚Äôt have strong guarantees. So if I edit a module, my hot reloading solution should re-execute that module and try to stop there if possible."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Editing a component shouldn‚Äôt destroy the state of its parents or siblings."}]," Similar to how ",["$","code",null,{"children":"setState()"}]," only affects the tree below, editing a component shouldn‚Äôt affect anything above it."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Edits to non-React code should propagate upwards."}]," If you edit a file with constants or pure functions that‚Äôs imported from several components, those components should update. It is acceptable to lose module state in such files."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"A runtime error introduced during hot reloading should not propagate."}]," If you make a mistake in one component, it shouldn‚Äôt break your whole app. In React, this is usually solved by error boundaries. However, they are too coarse for the countless typos we make while editing. I should be able to make and fix runtime errors while I work on a component without its siblings or parents unmounting. However, errors that ",["$","em",null,{"children":"don‚Äôt"}]," happen during hot reload (and are legitimate bugs in my code) should go to the closest error boundary."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Preserve own state unless it‚Äôs clear the developer doesn‚Äôt want to."}]," If you‚Äôre just tweaking styles, it‚Äôs frustrating for the state to reset on every edit. On the other hand, if you just changed the state shape or the initial state, you‚Äôll often prefer it to reset. By default we should try our best to preserve state. But if it leads to an error during hot reload, this is often a sign some assumption has changed, so we should reset state and ",["$","em",null,{"children":"retry"}]," rendering in that case. Commenting things out and back in is common so it‚Äôs important to handle that gracefully. For example, removing Hooks ",["$","em",null,{"children":"at the end"}]," shouldn‚Äôt reset state."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Discard state when it‚Äôs clear the developer wants to."}]," In some cases we can also proactively detect that the user wants to reset. For example, if the Hook order changed, or if primitive Hooks like ",["$","code",null,{"children":"useState"}]," change their initial state type. We can also offer a lightweight annotation that you can use to force a component to reset on every edit. Such as ",["$","code",null,{"children":"// !"}]," or some similar convention that‚Äôs fast to add and remove while you focus on how component mounts."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Support updating ‚Äúfixed‚Äù things."}]," If a component is wrapped in ",["$","code",null,{"children":"memo()"}],", hot reload should still update it. If an effect is called with ",["$","code",null,{"children":"[]"}],", it should still be replaced. Code is like an invisible variable. Previously, I thought it was important to force deep updates below for things like ",["$","code",null,{"children":"renderRow={this.renderRow}"}],". But in the Hooks world, we rely on closures anyway this seems unnecessary anymore. A different reference should be sufficient."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Support multiple components in one file."}]," It is a common pattern that multiple components are defined in the same file. Even if we only keep the state for function components, we want to make sure putting them in one file doesn‚Äôt cause them to lose state. Note these can be mutually recursive."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"When possible, preserve the state of children."}]," If you edit a component, it‚Äôs always frustrating if its children unintentionally lose state. As long as the element types of children are defined in other files, we expect their state to be preserved. If they‚Äôre in the same file, we should do our best effort."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Support custom Hooks."}]," For well-written custom Hooks (some cases like ",["$","code",null,{"children":"useInterval()"}]," can be a bit tricky), hot reloading any arguments (including functions) should work. This shouldn‚Äôt need extra work and follows from the design of Hooks. Our solution just shouldn‚Äôt get in the way."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Support render props."}]," This usually doesn‚Äôt pose problems but it‚Äôs worth verifying they work and get updated as expected."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Support higher-order components."}]," Wrapping export into a higher-order component like ",["$","code",null,{"children":"connect"}]," shouldn‚Äôt break hot reloading or state preservation. If you use a component created from a HOC in JSX (such as ",["$","code",null,{"children":"styled"}],"), and that component is a class, it‚Äôs expected that it loses state when instantiated in the edited file. But a HOC that returns a function component (potentially using Hooks) shouldn‚Äôt lose state even if it‚Äôs defined in the same file. In fact, even edits to its arguments (e.g. ",["$","code",null,{"children":"mapStateToProps"}],") should be reflected."]}],"\n"]}],"\n"]}],"\n",["$","h3",null,{"children":"Feedback"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Both success and failure should provide visual feedback."}]," You should always be confident whether a hot reload succeeded or failed. In case of a runtime or a syntax error you should see an overlay which should be automatically be dismissed after it is irrelevant. When hot reload is successful, there should be some visual feedback such as flashing updated components or a notification."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"A syntax error shouldn‚Äôt cause a runtime error or a refresh."}]," When you edit the code and you have a syntax error, it should be shown in a modal overlay (ideally, with a click-through to the editor). If you make another syntax error, the existing overlay is updated. Hot reloading is only attempted ",["$","em",null,{"children":"after"}]," you fix your syntax errors. Syntax error shouldn‚Äôt make you lose the state."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"A syntax error after reload should still be visible."}]," If you see a modal syntax error overlay and refresh, you should still be seeing it. It categorically should not let you run the last successful version (I‚Äôve seen that in some setups)."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Consider exposing power user tools."}]," With hot reloading, code itself can be your ‚Äúterminal‚Äù. In addition to the hypothetical ",["$","code",null,{"children":"// !"}]," command to force remount, there could be e.g. an ",["$","code",null,{"children":"// inspect"}]," command that shows a panel with props values next to the component. Be creative!"]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Minimize the noise."}]," DevTools and warning messages shouldn‚Äôt expose that we‚Äôre doing something special. Avoid breaking ",["$","code",null,{"children":"displayName"}],"s or adding useless wrappers to the debug output."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Debugging in major browsers should show the most recent code."}]," While this doesn‚Äôt exactly depend on us, we should do our best to ensure the browser debugger shows the most recent version of any file and that breakpoints work as expected."]}],"\n"]}],"\n",["$","li",null,{"children":["\n",["$","p",null,{"children":[["$","strong",null,{"children":"Optimize for fast iteration, not long refactoring."}]," This is JavaScript, not Elm. Any long-running series of edits likely won‚Äôt hot reload well due to a bunch of mistakes that need to be fixed one by one. When in doubt, optimize for the use case of tweaking a few components in a tight iteration loop rather than for a big refactor. And be predictable. Keep in mind that if you lose developer‚Äôs trust they‚Äôll refresh anyway."]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":"This was my wish list for how hot reloading in React ‚Äî or any component system that offers more than templates ‚Äî should work. There‚Äôs probably more stuff I will add here with time."}],"\n",["$","p",null,{"children":["I don‚Äôt know how many of these goals we can satisfy with JavaScript. But there‚Äôs one more reason I‚Äôm looking forward to working on hot reloading again. As an engineer I‚Äôm more organized than before. In particular, ",["$","strong",null,{"children":"I‚Äôve finally learned my lesson to write up requirements like this before diving into another implementation."}]]}],"\n",["$","p",null,{"children":"Maybe this one will actually work! But if it doesn‚Äôt, at least I‚Äôve left some breadcrumbs for the next person who tries it."}]]
