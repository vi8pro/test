<!DOCTYPE html><html lang="en" class="__className_e34cb4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://github.com/gaearon.png"/><link rel="stylesheet" href="/_next/static/css/0f6647b39fdbcb3d.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3c6c21fa7f32edf2.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f9d4d708579596e8.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-da4818c833129d2a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-44c3d350117a997d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-74b5bca37634105e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/569-52e5d813bbfa85ea.js" async=""></script><script src="/_next/static/chunks/app/layout-cfb37acb14684668.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js" async=""></script><title>Before You memo() ‚Äî overreacted</title><meta name="description" content="Rendering optimizations that come naturally."/><link rel="icon" href="/icon.png?e0852c1e2c7f0e65" type="image/png" sizes="329x329"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]"><header class="mb-14 flex flex-row place-content-between"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a><span class="relative top-[4px] italic">by<!-- --> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://danabra.mov"><img alt="Dan Abramov" src="https://github.com/gaearon.png" class="relative -top-1 mx-1 inline h-8 w-8 rounded-full"/></a></span></header><main><article><h1 class="__className_b47211 text-[40px] font-black leading-[44px] text-[--title]">Before You memo()</h1><p class="mt-2 text-[13px] text-gray-700 dark:text-gray-300">February 23, 2021</p><div class="markdown mt-10"><p>There are many articles written about React performance optimizations. In general, if some state update is slow, you need to:</p>
<ol>
<li>Verify you‚Äôre running a production build. (Development builds are intentionally slower, in extreme cases even by an order of magnitude.)</li>
<li>Verify that you didn‚Äôt put the state higher in the tree than necessary. (For example, putting input state in a centralized store might not be the best idea.)</li>
<li>Run React DevTools Profiler to see what gets re-rendered, and wrap the most expensive subtrees with <code>memo()</code>. (And add <code>useMemo()</code> where needed.)</li>
</ol>
<p>This last step is annoying, especially for components in between, and ideally a compiler would do it for you. In the future, it might.</p>
<p><strong>In this post, I want to share two different techniques.</strong> They‚Äôre surprisingly basic, which is why people rarely realize they improve rendering performance.</p>
<p><strong>These techniques are complementary to what you already know!</strong> They don‚Äôt replace <code>memo</code> or <code>useMemo</code>, but they‚Äôre often good to try first.</p>
<h2>An (Artificially) Slow Component</h2>
<p>Here‚Äôs a component with a severe rendering performance problem:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">import</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> useState </span><span style="color:#C792EA">}</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">from</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">react</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">export</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">default</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">App</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let [</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">setColor</span><span style="color:#FFA7C4">] </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">red</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">input</span><span style="color:#C792EA"> value={</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">} onChange={(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">) </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#C792EA"> </span><span style="color:#8EACE3">setColor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">)} /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA"> style={{ </span><span style="color:#CED2D6">color </span><span style="color:#C792EA">}}&gt;</span><span style="color:#CED2D6">Hello, world!</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ExpensiveTree</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">ExpensiveTree</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let </span><span style="color:#CED2D6">now</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> performance</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">now</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">while</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">performance</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">now</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">-</span><span style="color:#CED2D6"> now </span><span style="color:#C792EA">&lt;</span><span style="color:#CED2D6"> </span><span style="color:#F78C6C">100</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#637777">// Artificial delay -- do nothing for 100ms</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">I am a very slow component tree.</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;;</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p><em>(<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://codesandbox.io/s/frosty-glade-m33km?file=/src/App.js:23-513">Try it here</a>)</em></p>
<p>The problem is that whenever <code>color</code> changes inside <code>App</code>, we will re-render <code>&lt;ExpensiveTree /&gt;</code> which we‚Äôve artificially delayed to be very slow.</p>
<p>I could <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://codesandbox.io/s/amazing-shtern-61tu4?file=/src/App.js">put <code>memo()</code> on it</a> and call it a day, but there are many existing articles about it so I won‚Äôt spend time on it. I want to show two different solutions.</p>
<h2>Solution 1: Move State Down</h2>
<p>If you look at the rendering code closer, you‚Äôll notice only a part of the returned tree actually cares about the current <code>color</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">export</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">default</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">App</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let [</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">setColor</span><span style="color:#FFA7C4">] </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">red</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">input</span><span style="color:#C792EA"> value={</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">} onChange={(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">) </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#C792EA"> </span><span style="color:#8EACE3">setColor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">)} /&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA"> style={{ </span><span style="color:#CED2D6">color </span><span style="color:#C792EA">}}&gt;</span><span style="color:#CED2D6">Hello, world!</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ExpensiveTree</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p>So let‚Äôs extract that part into a <code>Form</code> component and move state <em>down</em> into it:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">export</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">default</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">App</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">Form</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ExpensiveTree</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">Form</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let [</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">setColor</span><span style="color:#FFA7C4">] </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">red</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">input</span><span style="color:#C792EA"> value={</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">} onChange={(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">) </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#C792EA"> </span><span style="color:#8EACE3">setColor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">)} /&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA"> style={{ </span><span style="color:#CED2D6">color </span><span style="color:#C792EA">}}&gt;</span><span style="color:#CED2D6">Hello, world!</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p><em>(<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://codesandbox.io/s/billowing-wood-1tq2u?file=/src/App.js:64-380">Try it here</a>)</em></p>
<p>Now if the <code>color</code> changes, only the <code>Form</code> re-renders. Problem solved.</p>
<h2>Solution 2: Lift Content Up</h2>
<p>The above solution doesn‚Äôt work if the piece of state is used somewhere <em>above</em> the expensive tree. For example, let‚Äôs say we put the <code>color</code> on the <em>parent</em> <code>&lt;div&gt;</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">export</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">default</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">App</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let [</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">setColor</span><span style="color:#FFA7C4">] </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">red</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA"> style={{ </span><span style="color:#CED2D6">color </span><span style="color:#C792EA">}}&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">input</span><span style="color:#C792EA"> value={</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">} onChange={(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">) </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#C792EA"> </span><span style="color:#8EACE3">setColor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">)} /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">Hello, world!</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ExpensiveTree</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p><em>(<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://codesandbox.io/s/bold-dust-0jbg7?file=/src/App.js:58-313">Try it here</a>)</em></p>
<p>Now it seems like we can‚Äôt just ‚Äúextract‚Äù the parts that don‚Äôt use <code>color</code> into another component, since that would include the parent <code>&lt;div&gt;</code>, which would then include <code>&lt;ExpensiveTree /&gt;</code>. Can‚Äôt avoid <code>memo</code> this time, right?</p>
<p>Or can we?</p>
<p>Play with this sandbox and see if you can figure it out.</p>
<p>‚Ä¶</p>
<p>‚Ä¶</p>
<p>‚Ä¶</p>
<p>The answer is remarkably plain:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="jsx" data-theme="default"><code data-language="jsx" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">export</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">default</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">App</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ColorPicker</span><span style="color:#C792EA">&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">Hello, world!</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">p</span><span style="color:#C792EA">&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">ExpensiveTree</span><span style="color:#C792EA"> /&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">ColorPicker</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line="" data-highlighted-line=""><span style="color:#FFA7C4">function</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">ColorPicker</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">{ children }</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">let [</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">setColor</span><span style="color:#FFA7C4">] </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">useState</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&quot;</span><span style="color:#ECC48D">red</span><span style="color:#C792EA">&quot;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">return</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA"> style={{ </span><span style="color:#CED2D6">color </span><span style="color:#C792EA">}}&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">input</span><span style="color:#C792EA"> value={</span><span style="color:#CED2D6">color</span><span style="color:#C792EA">} onChange={(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">) </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#C792EA"> </span><span style="color:#8EACE3">setColor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">)} /&gt;</span></span>
<span data-line="" data-highlighted-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">{</span><span style="color:#CED2D6">children</span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">div</span><span style="color:#C792EA">&gt;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<p><em>(<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://codesandbox.io/s/wonderful-banach-tyfr1?file=/src/App.js:58-423">Try it here</a>)</em></p>
<p>We split the <code>App</code> component in two. The parts that depend on the <code>color</code>, together with the <code>color</code> state variable itself, have moved into <code>ColorPicker</code>.</p>
<p>The parts that don‚Äôt care about the <code>color</code> stayed in the <code>App</code> component and are passed to <code>ColorPicker</code> as JSX content, also known as the <code>children</code> prop.</p>
<p>When the <code>color</code> changes, <code>ColorPicker</code> re-renders. But it still has the same <code>children</code> prop it got from the <code>App</code> last time, so React doesn‚Äôt visit that subtree.</p>
<p>And as a result, <code>&lt;ExpensiveTree /&gt;</code> doesn‚Äôt re-render.</p>
<h2>What‚Äôs the moral?</h2>
<p>Before you apply optimizations like <code>memo</code> or <code>useMemo</code>, it might make sense to look if you can split the parts that change from the parts that don‚Äôt change.</p>
<p>The interesting part about these approaches is that <strong>they don‚Äôt really have anything to do with performance, per se</strong>. Using the <code>children</code> prop to split up components usually makes the data flow of your application easier to follow and reduces the number of props plumbed down through the tree. Improved performance in cases like this is a cherry on top, not the end goal.</p>
<p>Curiously, this pattern also unlocks <em>more</em> performance benefits in the future.</p>
<p>For example, when <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html">Server Components</a> are stable and ready for adoption, our <code>ColorPicker</code> component could receive its <code>children</code> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://youtu.be/TQQPAU21ZUw?t=1314">from the server</a>. Either the whole <code>&lt;ExpensiveTree /&gt;</code> component or its parts could run on the server, and even a top-level React state update would ‚Äúskip over‚Äù those parts on the client.</p>
<p>That‚Äôs something even <code>memo</code> couldn‚Äôt do! But again, both approaches are complementary. Don‚Äôt neglect moving state down (and lifting content up!)</p>
<p>Then, where it‚Äôs not enough, use the Profiler and sprinkle those memo‚Äôs.</p>
<h2>Didn‚Äôt I read about this before?</h2>
<p><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://kentcdodds.com/blog/optimize-react-re-renders">Yes, probably.</a></p>
<p>This is not a new idea. It‚Äôs a natural consequence of React composition model. It‚Äôs simple enough that it‚Äôs underappreciated, and deserves a bit more love.</p><hr/><p><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fbefore-you-memo%2F">Discuss on ùïè</a>¬†¬†¬∑¬†¬†<a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/gaearon/overreacted.io/edit/main/public/before-you-memo/index.md">Edit on GitHub</a></p></div></article><footer class="mt-12"><a class="__className_b47211 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a></footer></main><script src="/_next/static/chunks/webpack-fdca05b8968262b2.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/0f6647b39fdbcb3d.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/3c6c21fa7f32edf2.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/f9d4d708579596e8.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[3728,[],\"\"]\n7:I[9928,[],\"\"]\n8:I[4982,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"185\",\"static/chunks/app/layout-cfb37acb14684668.js\"],\"\"]\n9:I[8256,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"64\",\"static/chunks/app/%5Bslug%5D/layout-d3e08fbfdc858bf2.js\"],\"\"]\na:I[2008,[\"569\",\"static/chunks/569-52e5d813bbfa85ea.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-798073576b23f3f1.js\"],\"\"]\nb:I[6954,[],\"\"]\nc:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f6647b39fdbcb3d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"iWWiOWlg3tDiHen4DuUO-\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/before-you-memo/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"before-you-memo\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"before-you-memo\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"$L8\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__className_e34cb4\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-14 flex flex-row place-content-between\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"span\",null,{\"className\":\"relative top-[4px] italic\",\"children\":[\"by\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://danabra.mov\",\"target\":\"_blank\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Dan Abramov\",\"src\":\"https://github.com/gaearon.png\",\"className\":\"relative -top-1 mx-1 inline h-8 w-8 rounded-full\"}]}]]}]]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"article\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Not found\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[[\"$\",\"p\",null,{\"children\":\"This page doesn't exist (yet?)\"}],[\"$\",\"p\",null,{\"children\":[\"I recently rewrote the site so maybe something broke. Please\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/issues/796\",\"children\":\"complain here.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If you're looking for translated posts, they're not on the site anymore but you can find\",\" \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/tree/archive/src/pages\",\"children\":\"an archive of them here.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Hope you'll find what you're looking for.\"}]]}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"childProp\":{\"current\":[null,[[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",[\"slug\",\"before-you-memo\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",\"$Le\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"before-you-memo\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f9d4d708579596e8.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-12\",\"children\":[\"$\",\"$L9\",null,{}]}]],null],\"segment\":[\"slug\",\"before-you-memo\",\"d\"]},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3c6c21fa7f32edf2.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"article\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_b47211 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Before You memo()\"}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-[13px] text-gray-700 dark:text-gray-300\",\"children\":\"February 23, 2021\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[\"$Lf\",[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"$La\",null,{\"href\":\"https://x.com/search?q=https%3A%2F%2Foverreacted.io%2Fbefore-you-memo%2F\",\"children\":\"Discuss on ùïè\"}],\"¬†¬†¬∑¬†¬†\",[\"$\",\"$La\",null,{\"href\":\"https://github.com/gaearon/overreacted.io/edit/main/public/before-you-memo/index.md\",\"children\":\"Edit on GitHub\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Before You memo() ‚Äî overreacted\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Rendering optimizations that come naturally.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/icon.png?e0852c1e2c7f0e65\",\"type\":\"image/png\",\"sizes\":\"329x329\"}]]\nd:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"p\",null,{\"children\":\"There are many articles written about React performance optimizations. In general, if some state update is slow, you need to:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Verify you‚Äôre running a production build. (Development builds are intentionally slower, in extreme cases even by an order of magnitude.)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Verify that you didn‚Äôt put the state higher in the tree than necessary. (For example, putting input state in a centralized store might not be the best idea.)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Run React DevTools Profiler to see what gets re-rendered, and wrap the most expensive subtrees with \",[\"$\",\"code\",null,{\"children\":\"memo()\"}],\". (And add \",[\"$\",\"code\",null,{\"children\":\"useMemo()\"}],\" where needed.)\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This last step is annoying, especially for components in between, and ideally a compiler would do it for you. In the future, it might.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"In this post, I want to share two different techniques.\"}],\" They‚Äôre surprisingly basic, which is why people rarely realize they improve rendering performance.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"These techniques are complementary to what you already know!\"}],\" They don‚Äôt replace \",[\"$\",\"code\",null,{\"children\":\"memo\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"useMemo\"}],\", but they‚Äôre often good to try first.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"An (Artificially) Slow Component\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here‚Äôs a component with a severe rendering performance problem:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" useState \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"react\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"red\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" value={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"} onChange={(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")} /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" style={{ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}}\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Hello, world!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"now\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" performance\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"now\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"while\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"performance\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"now\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" now \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"100\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// Artificial delay -- do nothing for 100ms\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"I am a very slow component tree.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"(\",[\"$\",\"$La\",null,{\"href\":\"https://codesandbox.io/s/frosty-glade-m33km?file=/src/App.js:23-513\",\"children\":\"Try it here\"}],\")\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The problem is that whenever \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" changes inside \",[\"$\",\"code\",null,{\"children\":\"App\"}],\", we will re-render \",[\"$\",\"code\",null,{\"children\":\"\u003cExpensiveTree /\u003e\"}],\" which we‚Äôve artificially delayed to be very slow.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"I could \",[\"$\",\"$La\",null,{\"href\":\"https://codesandbox.io/s/amazing-shtern-61tu4?file=/src/App.js\",\"children\":[\"put \",[\"$\",\"code\",null,{\"children\":\"memo()\"}],\" on it\"]}],\" and call it a day, but there are many existing articles about it so I won‚Äôt spend time on it. I want to show two different solutions.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Solution 1: Move State Down\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you look at the rendering code closer, you‚Äôll notice only a part of the returned tree actually cares about the current \",[\"$\",\"code\",null,{\"children\":\"color\"}],\":\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"red\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" value={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"} onChange={(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")} /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" style={{ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}}\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Hello, world!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"So let‚Äôs extract that part into a \",[\"$\",\"code\",null,{\"children\":\"Form\"}],\" component and move state \",[\"$\",\"em\",null,{\"children\":\"down\"}],\" into it:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"Form\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"Form\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"red\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" value={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"} onChange={(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")} /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" style={{ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}}\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Hello, world!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"(\",[\"$\",\"$La\",null,{\"href\":\"https://codesandbox.io/s/billowing-wood-1tq2u?file=/src/App.js:64-380\",\"children\":\"Try it here\"}],\")\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now if the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" changes, only the \",[\"$\",\"code\",null,{\"children\":\"Form\"}],\" re-renders. Problem solved.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Solution 2: Lift Content Up\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The above solution doesn‚Äôt work if the piece of state is used somewhere \",[\"$\",\"em\",null,{\"children\":\"above\"}],\" the expensive tree. For example, let‚Äôs say we put the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" on the \",[\"$\",\"em\",null,{\"children\":\"parent\"}],\" \",[\"$\",\"code\",null,{\"children\":\"\u003cdiv\u003e\"}],\":\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"red\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" style={{ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}}\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" value={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"} onChange={(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")} /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Hello, world!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"(\",[\"$\",\"$La\",null,{\"href\":\"https://codesandbox.io/s/bold-dust-0jbg7?file=/src/App.js:58-313\",\"children\":\"Try it here\"}],\")\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now it seems like we can‚Äôt just ‚Äúextract‚Äù the parts that don‚Äôt use \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" into another component, since that would include the parent \",[\"$\",\"code\",null,{\"children\":\"\u003cdiv\u003e\"}],\", which would then include \",[\"$\",\"code\",null,{\"children\":\"\u003cExpensiveTree /\u003e\"}],\". Can‚Äôt avoid \",[\"$\",\"code\",null,{\"children\":\"memo\"}],\" this time, right?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Or can we?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Play with this sandbox and see if you can figure it out.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"‚Ä¶\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"‚Ä¶\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"‚Ä¶\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The answer is remarkably plain:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"jsx\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"jsx\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ColorPicker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"Hello, world!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ExpensiveTree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"ColorPicker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"ColorPicker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"{ children }\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"let [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"useState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"red\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" style={{ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}}\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" value={\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"color\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"} onChange={(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setColor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")} /\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"data-highlighted-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"children\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"(\",[\"$\",\"$La\",null,{\"href\":\"https://codesandbox.io/s/wonderful-banach-tyfr1?file=/src/App.js:58-423\",\"children\":\"Try it here\"}],\")\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We split the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\" component in two. The parts that depend on the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\", together with the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" state variable itself, have moved into \",[\"$\",\"code\",null,{\"children\":\"ColorPicker\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The parts that don‚Äôt care about the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" stayed in the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\" component and are passed to \",[\"$\",\"code\",null,{\"children\":\"ColorPicker\"}],\" as JSX content, also known as the \",[\"$\",\"code\",null,{\"children\":\"children\"}],\" prop.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When the \",[\"$\",\"code\",null,{\"children\":\"color\"}],\" changes, \",[\"$\",\"code\",null,{\"children\":\"ColorPicker\"}],\" re-renders. But it still has the same \",[\"$\",\"code\",null,{\"children\":\"children\"}],\" prop it got from the \",[\"$\",\"code\",null,{\"children\":\"App\"}],\" last time, so React doesn‚Äôt visit that subtree.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"And as a result, \",[\"$\",\"code\",null,{\"children\":\"\u003cExpensiveTree /\u003e\"}],\" doesn‚Äôt re-render.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"What‚Äôs the moral?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Before you apply optimizations like \",[\"$\",\"code\",null,{\"children\":\"memo\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"useMemo\"}],\", it might make sense to look if you can split the parts that change from the parts that don‚Äôt change.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The interesting part about these approaches is that \",[\"$\",\"strong\",null,{\"children\":\"they don‚Äôt really have anything to do with performance, per se\"}],\". Using the \",[\"$\",\"code\",null,{\"children\":\"children\"}],\" prop to split up components usually makes the data flow of your application easier to follow and reduces the number of props plumbed down through the tree. Improved performance in cases like this is a cherry on top, not the end goal.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Curiously, this pattern also unlocks \",[\"$\",\"em\",null,{\"children\":\"more\"}],\" performance benefits in the future.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For example, when \",[\"$\",\"$La\",null,{\"href\":\"https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html\",\"children\":\"Server Components\"}],\" are stable and ready for adoption, our \",[\"$\",\"code\",null,{\"children\":\"ColorPicker\"}],\" component could receive its \",[\"$\",\"code\",null,{\"children\":\"children\"}],\" \",[\"$\",\"$La\",null,{\"href\":\"https://youtu.be/TQQPAU21ZUw?t=1314\",\"children\":\"from the server\"}],\". Either the whole \",[\"$\",\"code\",null,{\"children\":\"\u003cExpensiveTree /\u003e\"}],\" component or its parts could run on the server, and even a top-level React state update would ‚Äúskip over‚Äù those parts on the client.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"That‚Äôs something even \",[\"$\",\"code\",null,{\"children\":\"memo\"}],\" couldn‚Äôt do! But again, both approaches are complementary. Don‚Äôt neglect moving state down (and lifting content up!)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Then, where it‚Äôs not enough, use the Profiler and sprinkle those memo‚Äôs.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Didn‚Äôt I read about this before?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"https://kentcdodds.com/blog/optimize-react-re-renders\",\"children\":\"Yes, probably.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is not a new idea. It‚Äôs a natural consequence of React composition model. It‚Äôs simple enough that it‚Äôs underappreciated, and deserves a bit more love.\"}]]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>